<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Top Pedicures in {{ location }} | Best Local Nail Salons</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
</head>
<body>
    <header class="main-header">
        <div class="container">
            <div class="logo">
                <a href="/">
                    <img src="{{ url_for('static', filename='images/logo-placeholder.png') }}" alt="Pedicure Near Me Directory" width="180" height="60">
                </a>
            </div>
            <nav class="main-nav">
                <ul>
                    <li><a href="/">Home</a></li>
                    <li><a href="/search">Find Pedicures</a></li>
                    <li><a href="/about">About</a></li>
                    <li><a href="/contact">Contact</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <main>
        <section class="listings-header">
            <div class="container">
                <h1>{% if is_city %}Top Pedicures in{% else %}Pedicures in{% endif %} {{ location }}</h1>
                <p class="results-count">Showing {{ listings|length }} of {{ total_listings }} pedicure locations</p>
                
                <!-- Filters -->
                <div class="filters">
                    <form method="GET" class="filter-form">
                        {% if location %}<input type="hidden" name="location" value="{{ location }}">{% endif %}
                        {% if state %}<input type="hidden" name="state" value="{{ state }}">{% endif %}
                        
                        <select name="min_rating" class="filter-select" id="min-rating" aria-label="Filter by minimum rating">
                            <option value="">Minimum Rating</option>
                            {% for rating in range(5, 0, -1) %}
                                <option value="{{ rating }}"{% if filters and filters.min_rating and (filters.min_rating|string|float == rating|float) %} selected{% endif %}>
                                    {{ rating }}+ Stars
                                </option>
                            {% endfor %}
                        </select>
                        
                        <select name="price_level" class="filter-select" id="price-level" aria-label="Filter by price level">
                            <option value="">Price Level</option>
                            {% set price_levels = ["$", "$$", "$$$", "$$$$"] %}
                            {% for price in price_levels %}
                                <option value="{{ price }}"{% if filters and filters.price_level and (filters.price_level == price) %} selected{% endif %}>
                                    {{ price }}
                                </option>
                            {% endfor %}
                        </select>
                        
                        <select name="sort" class="filter-select" id="sort-by" aria-label="Sort results by">
                            {% set sort_options = [
                                ("rating", "Sort by Rating"),
                                ("reviews", "Sort by Review Count"),
                                ("name", "Sort by Name")
                            ] %}
                            {% for value, label in sort_options %}
                                <option value="{{ value }}"{% if filters and filters.sort_by and (filters.sort_by == value) %} selected{% endif %}>
                                    {{ label }}
                                </option>
                            {% endfor %}
                        </select>
                        
                        <button type="submit" class="filter-button">Apply Filters</button>
                    </form>
                </div>
            </div>
        </section>

        <section class="listings-view">
            <div class="view-toggle">
                <button class="view-button active" data-view="grid">Grid View</button>
                <button class="view-button" data-view="map">Map View</button>
            </div>
            
            <div class="map-container" style="display: none;">
                <iframe class="map-frame" src="{{ url_for('static', filename='map.html') }}" width="100%" height="600" frameborder="0" style="border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);"></iframe>
            </div>
            
            <div class="listings-grid">
                <div class="container">
                {% for listing in listings %}
                <div class="listing-card">
                    <div class="listing-image">
                        {% if listing.featured_image %}
                        <img src="{{ listing.featured_image }}" alt="{{ listing.business_name }}">
                        {% endif %}
                    </div>
                    <div class="listing-content">
                        <h2>{{ listing.business_name }}</h2>
                        <div class="listing-meta">
                            <span class="rating">â˜… {{ "%.1f"|format(listing.rating) }}</span>
                            <span class="reviews">({{ listing.reviews }} reviews)</span>
                            {% if listing.price_level %}
                            <span class="price-level">{{ listing.price_level }}</span>
                            {% endif %}
                        </div>
                        <p class="address">{{ listing.address }}</p>
                        {% if listing.hours %}
                        <div class="hours">
                            {{ listing.hours|truncate(100) }}
                        </div>
                        {% endif %}
                        {% if listing.phone %}
                        <div class="phone">
                            {{ listing.phone }}
                        </div>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            </div>
            
            <!-- Pagination -->
            {% if total_pages and (total_pages|int > 1) %}
            <div class="pagination">
                {% if current_page and (current_page|int > 1) %}
                <a href="{{ url_for('search', page=current_page-1, location=location, state=state, min_rating=filters.min_rating, price_level=filters.price_level, sort=filters.sort_by) }}" class="page-link">&laquo; Previous</a>
                {% endif %}
                
                {% for p in range(1, total_pages + 1) %}
                    {% if p == current_page %}
                    <span class="page-current">{{ p }}</span>
                    {% else %}
                    <a href="{{ url_for('search', page=p, location=location, state=state, min_rating=filters.min_rating, price_level=filters.price_level, sort=filters.sort_by) }}" class="page-link">{{ p }}</a>
                    {% endif %}
                {% endfor %}
                
                {% if current_page and total_pages and (current_page|int < total_pages|int) %}
                <a href="{{ url_for('search', page=current_page+1, location=location, state=state, min_rating=filters.min_rating, price_level=filters.price_level, sort=filters.sort_by) }}" class="page-link">Next &raquo;</a>
                {% endif %}
            </div>
            {% endif %}
        </section>
    </main>

    <footer class="main-footer">
        <div class="container">
            <p>&copy; 2025 Pedicure Near Me Directory. All rights reserved.</p>
        </div>
    </footer>
</body>
</html>
